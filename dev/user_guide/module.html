

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Modules &mdash; DLTK 0.2.0rc0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/banner.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="DLTK 0.2.0rc0 documentation" href="../index.html"/>
        <link rel="next" title="Models" href="model.html"/>
        <link rel="prev" title="Getting Started" href="getting_started.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo-dltk.svg" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="model.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="reader.html">Reader</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage &amp; Further resources</a></li>
</ul>
<p class="caption"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/dltk.html">dltk package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/dltk.core.html">dltk.core package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/dltk.core.html#module-dltk.core.activations">dltk.core.activations module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/dltk.core.html#module-dltk.core.losses">dltk.core.losses module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/dltk.core.html#module-dltk.core.metrics">dltk.core.metrics module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/dltk.core.html#module-dltk.core.residual_unit">dltk.core.residual_unit module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/dltk.core.html#module-dltk.core.upsample">dltk.core.upsample module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/dltk.core.html#module-dltk.core">Module contents</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/dltk.io.html">dltk.io package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/dltk.io.html#module-dltk.io.augmentation">dltk.io.augmentation module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/dltk.io.html#module-dltk.io.preprocessing">dltk.io.preprocessing module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/dltk.io.html#module-dltk.io.abstract_reader">dltk.core.io.abstract_reader module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/dltk.io.html#module-dltk.io">Module contents</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/dltk.networks.html">dltk.networks package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/dltk.networks.autoencoder.html">dltk.networks.autoencoder package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/dltk.networks.autoencoder.html#module-dltk.networks.autoencoder.convolutional_autoencoder">dltk.networks.autoencoder.convolutional_autoencoder module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/dltk.networks.autoencoder.html#module-dltk.networks.autoencoder">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/dltk.networks.gan.html">dltk.networks.gan package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/dltk.networks.gan.html#module-dltk.networks.gan.dcgan">dltk.networks.gan.dcgan module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/dltk.networks.gan.html#module-dltk.networks.gan">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/dltk.networks.regression_classification.html">dltk.networks.regression_classification package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/dltk.networks.regression_classification.html#module-dltk.networks.regression_classification.resnet">dltk.networks.regression_classification.resnet module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/dltk.networks.regression_classification.html#module-dltk.networks.regression_classification">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/dltk.networks.segmentation.html">dltk.networks.segmentation package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/dltk.networks.segmentation.html#module-dltk.networks.segmentation.deepmedic">dltk.networks.segmentation.deepmedic module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/dltk.networks.segmentation.html#module-dltk.networks.segmentation.fcn">dltk.networks.segmentation.fcn module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/dltk.networks.segmentation.html#module-dltk.networks.segmentation.unet">dltk.networks.segmentation.unet module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/dltk.networks.segmentation.html#module-dltk.networks.segmentation">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/dltk.networks.super_resolution.html">dltk.networks.super_resolution package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/dltk.networks.super_resolution.html#module-dltk.networks.super_resolution.simple_super_resolution">dltk.networks.super_resolution.simple_super_resolution module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/dltk.networks.super_resolution.html#module-dltk.networks.super_resolution">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/dltk.networks.html#module-dltk.networks">Module contents</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/dltk.html#module-dltk.utils">dltk.utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/dltk.html#module-dltk">Module contents</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DLTK</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Modules</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/user_guide/module.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="modules">
<span id="modules"></span><h1>Modules<a class="headerlink" href="#modules" title="Permalink to this headline">Â¶</a></h1>
<p>Modules build the foundation of DLTK and are mostly used to implement layers of neural networks. Modules are implemented as objects which handle variable sharing. To do this we followed the style of <a class="reference external" href="https://github.com/deepmind/sonnet">Sonnet</a> and used <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/make_template">tf.make_template</a>.
To implement a new module you simply need to inherit from the  dltk.core.modules.base.AbstractModule class and overwrite the <code class="docutils literal"><span class="pre">__init__</span></code> and <code class="docutils literal"><span class="pre">build</span></code> methods.</p>
<p>A simple example is the  dltk.core.modules.linear.Linear layer that implements a simple matrix multiplication. The <code class="docutils literal"><span class="pre">__init__</span></code> method stores all necessary parameters for the module like the number of output units and whether to add a bias or not. It then calls the super class&#8217; <code class="docutils literal"><span class="pre">__init__</span></code> function to build the template:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Linear</span><span class="p">(</span><span class="n">AbstractModule</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Linear layer module</span>

<span class="sd">    This module builds a linear layer</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_units</span><span class="p">,</span> <span class="n">use_bias</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructs linear layer</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        out_units : int</span>
<span class="sd">            number of output units</span>
<span class="sd">        use_bias : bool, optional</span>
<span class="sd">            flag to toggle the addition of a bias</span>
<span class="sd">        name : string</span>
<span class="sd">            name of the module</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_units</span> <span class="o">=</span> <span class="n">out_units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_units</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span> <span class="o">=</span> <span class="n">use_bias</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Linear</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">build</span></code> function then handles the actual implementation of the module. All variables have to be created with <code class="docutils literal"><span class="pre">tf.get_variable</span></code>. Variable sharing and scoping is automatically handled by <code class="docutils literal"><span class="pre">tf.make_template</span></code> which is called in the
dltk.core.modules.base.AbstractModule class.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">_build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
       <span class="sd">&quot;&quot;&quot;Applies the linear layer operation to an input tensor</span>

<span class="sd">       Parameters</span>
<span class="sd">       ----------</span>
<span class="sd">       inp : tf.Tensor</span>
<span class="sd">           input tensor</span>


<span class="sd">       Returns</span>
<span class="sd">       -------</span>
<span class="sd">       tf.Tensor</span>
<span class="sd">           transformed tensor</span>

<span class="sd">       &quot;&quot;&quot;</span>
       <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">get_shape</span><span class="p">()</span><span class="o">.</span><span class="n">as_list</span><span class="p">())</span>  <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Layer needs 2D input.&#39;</span><span class="p">)</span>

       <span class="bp">self</span><span class="o">.</span><span class="n">in_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">get_shape</span><span class="p">()</span><span class="o">.</span><span class="n">as_list</span><span class="p">())</span>
       <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_units</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">in_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

       <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_units</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;Layer was initialised for a different number of input units.&#39;</span><span class="p">)</span>

       <span class="n">w_shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_units</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_units</span><span class="p">)</span>

       <span class="bp">self</span><span class="o">.</span><span class="n">_w</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">w_shape</span><span class="p">,</span> <span class="n">initializer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">uniform_unit_scaling_initializer</span><span class="p">(),</span>
                                 <span class="n">collections</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">WEIGHT_COLLECTIONS</span><span class="p">)</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_w</span><span class="p">)</span>

       <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_units</span><span class="p">,),</span> <span class="n">initializer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">constant_initializer</span><span class="p">(),</span>
                                     <span class="n">collections</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">BIAS_COLLECTIONS</span><span class="p">)</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">)</span>
           <span class="n">outp</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">xw_plus_b</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">)</span>
       <span class="k">else</span><span class="p">:</span>
           <span class="n">outp</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_w</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">)</span>

       <span class="k">return</span> <span class="n">outp</span>
</pre></div>
</div>
<p>The output of this function is passed through wrappers and returned when an instance of this module is called:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">linear</span> <span class="o">=</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="n">outp</span> <span class="o">=</span> <span class="n">linear</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1">#this is the same outp as returned in `build`</span>
</pre></div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="model.html" class="btn btn-neutral float-right" title="Models" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="getting_started.html" class="btn btn-neutral" title="Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, DLTK contributors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: dev
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="module.html">dev</a></dd>
            <dd><a href="../../master/user_guide/module.html">master</a></dd>
        </dl>
    </div>
</div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.2.0rc0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>